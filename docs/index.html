<!DOCTYPE html>
<html>

<head>
    <title>dripfeed</title>
    <meta charset="UTF-8">
    <script>
        var baseUrl = 'https://dripfeed-app.azurewebsites.net/api/ExtractArticle';
        function addDrip(event) {
            event.preventDefault();

            var form = event.target;
            var url = encodeURIComponent(form.url.value);
            var email = encodeURIComponent(form.email.value);
            var wordLimit = encodeURIComponent(form.wordLimit.value);
            var queryString = `?url=${url}&email=${email}&wordLimit=${wordLimit}`;

            form.submit.value = 'processing...';
            form.submit.disabled = true;

            var xhr = new XMLHttpRequest();
            const dripUrl = baseUrl + queryString;
            xhr.open('POST', dripUrl);
            xhr.addEventListener('error', function () {
                alert(`A network error occurred. Please ensure that you have connectivity to ${baseUrl}`);
                form.submit.value = 'drip...';
                form.submit.disabled = false;
            });
            xhr.addEventListener('load', function () {
                if (this.status === 400) {
                    alert(this.responseText);
                } else if (this.status !== 200) {
                    alert('An unknown error occurred.');
                    console.log(this.responseText);
                } else {
                    var response = JSON.parse(this.responseText);
                    var title = response.title;
                    var count = response.count;
                    alert(`${title} coming to your inbox in ${count} installments`);
                }
                form.url.value = '';
                form.url.focus();
                form.submit.value = 'drip...';
                form.submit.disabled = false;
            });
            xhr.send();

            return false;
        }
    </script>
    <style>
        #dripfeed {
            width: 320px;
            margin: 20% auto auto auto;
        }
        #dripfeed > * {
            margin: 10px;
            padding: 6px;
            width: 300px;
        }
        #dripfeed > input[type=url], input[type=email] {
            -moz-box-sizing:border-box;
            -webkit-box-sizing:border-box;
            box-sizing:border-box;
        }
        @media screen and (max-width: 1080px) {
            #dripfeed {
                width: 100%;
                margin: 20% auto auto auto;
            }
            #dripfeed > * {
                margin: 10px 5% 10px 5%;
                padding: 6px;
                width: 90%;
            }
            #dripfeed > h1 {
                font-size: 5em;
            }
            #dripfeed > input, p {
                font-size: 3em;
            }
        }
    </style>
</head>

<body>
    <form id="dripfeed" onsubmit="return addDrip(event);">
        <h1>dripfeed</h1>
        <input type="url" name="url" required autofocus autocomplete="off" placeholder="https://example.com" />
        <input type="email" name="email" required placeholder="user@example.com" />
        <input type="hidden" name="wordLimit" value="3000" />
        <input type="submit" name="submit" value="drip..." />
        <p><a href="./about.html">About</a> | <a href="./privacy.html">Privacy</a></p>
    </form>
</body>

</html>